{% extends 'base.html.twig' %}
{% block title%} Mon profil {% endblock %}

{% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock %}

{% block background %}
    class="background-profile" style="background: url('{{ asset('build/images/background/bgimg' ~ random(1, 11) ~ '.jpeg') }}') no-repeat fixed center; background-size: cover;"
{% endblock %}

{% block body %}
    {{ form_start(form, {'attr': {'class': 'form-kyosc'} }) }}
    <div class="container">
        <header class="arrow-header my-3 text-uppercase">
            <h1 class="mt-2">Mes informations</h1>
        </header>
        <div class="row">
            <div class="col-12 col-lg-6">
                <p class="font-weight-bold">Nombre de points: {{ app.user.points }}</p>
                <p class="font-weight-bold">{{ app.user.email }}</p>
            </div>
            <div class="col-12 col-lg-6 p-3 d-flex justify-content-center">
                <button type="submit" class="btn-login btn btn-lg">Enregistrer mes modifications</button>
            </div>
        </div>

    </div>
    <div class="container d-flex margin-bottom">
        <div class="row">
            <div class="container col-lg-6 col-12 profil-container">
                <label for="edit_profil_profilPhotoFile_file" class="form-group img-display">
                    {% if app.user.profilPhoto is not null%}
                        <img id="output" src="{{ vich_uploader_asset(user, 'profilPhotoFile') | imagine_filter('avatar_thumb') }}" alt="{{ app.user.profilPhoto }}" class="profil-photo cursor-pointer w-75">
                    {% else %}
                        <img id="output" src="{{ asset('uploads/profils/default-profil-picture.png') }}" alt="default profil picture" class="profil-photo cursor-pointer">
                    {% endif %}
                </label>
            </div>
            <div class="container col-lg-6 col-12">
                <div class="row">
                    <div class="form-group col-md-6 col-12 col-lg-6">
                        <a type="submit" class="btn btn-profil width-margin mt-0" href="{{ path("profil_edit_email") }}">Modifier mon mail</a>
                    </div>
                    <div class="form-group col-md-6 col-lg-6">
                        <a type="submit" href="{{ path("app_forgot_password_request") }}" class="width-margin btn btn-profil">Modifier mon mot de passe</a>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-6">
                        {{ form_widget(form.firstName) }}
                        {{ form_errors(form.firstName) }}
                    </div>
                    <div class="form-group col-6">
                        {{ form_widget(form.lastName) }}
                        {{ form_errors(form.lastName) }}
                    </div>
                    <div class="form-group col-lg-8">
                        {{ form_widget(form.pseudo) }}
                        {{ form_errors(form.pseudo) }}
                    </div>
                    <div class="form-group col-lg-4">
                        {{ form_widget(form.age) }}
                        {{ form_errors(form.age) }}
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-md-12 col-sm-12">
                        {{ form_widget(form.address) }}
                        {{ form_errors(form.address) }}
                    </div>
                    <div class="form-group col-md-6 col-sm-6">
                        {{ form_widget(form.city) }}
                        {{ form_errors(form.city) }}
                    </div>
                    <div class="form-group col-md-6 col-sm-6">
                        {{ form_widget(form.postalCode) }}
                        {{ form_errors(form.postalCode) }}
                    </div>
                </div>

                <div class="form-group">
                    {{ form_widget(form.biography) }}
                    {{ form_help(form.biography) }}
                    {{ form_errors(form.biography) }}
                </div>
                <div class="form-group">
                    {{ form_widget(form.testimony) }}
                    {{ form_errors(form.testimony) }}
                </div>
                <div class="fileUpload">
                    {{ form_widget(form.profilPhotoFile) }}
                    {{ form_errors(form.profilPhotoFile) }}
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex align-items-center justify-content-center flex-column mt-5 w-100">
        <a class="journey-link-dark" data-toggle="modal" data-target="#favoriteSportChoice">
            <h2 class="mt-5 arrow-header">{{ form_label(form.favoriteSports) }}
                <img src="{{ asset('build/images/fleche/fbnoir.png') }}" class="w-25">
            </h2>
        </a>
        <div class="modal fade" id="favoriteSportChoice" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="form-check d-flex align-items-center mt-0 py-5 flex-row flex-wrap justify-content-center background-grey w-100">
                        {% for category in categories %}
                            <div class="d-flex flex-column align-items-center w-100 mt-2 mx-5 pt-2 transparent-background-dark">
                                <h3 class="text-center" style="color: {{ category.color }}"><img src="/uploads/logo/{{ category.logo }}" class="home-carousel-logo"> Univers {{ category.name }}</h3>
                                <div class="d-flex flex-wrap justify-content-center align-items-center w-100">
                                    {% for sport in form.favoriteSports.children %}
                                        {% if sport.vars.attr['category'].id == category.id %}
                                            <div class="favorite-sport-container d-flex flex-column align-items-center form-group cursor-pointer py-2 m-1 {{ sport.vars.checked? "my-sport-check" : "" }}"
                                                 data-checkBoxContainer
                                            >
                                                <img class="img-goutte" src="/uploads/goutte/{{ sport.vars.attr['data-img'] }}" alt="{{ sport.vars.label }}">
                                                <p class="m-0">
                                                    <label class="m-0 text-center" for="{{ sport.vars.id }}">{{ sport.vars.label }}</label>
                                                </p>
                                                <div class="d-none">
                                                    {{ form_widget(sport, {'attr': {'class': 'd-none'}}) }}
                                                </div>
                                                {{ form_errors(sport) }}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="background-grey">
        <div class="container d-flex flex-column pt-3">
            <a class="journey-link-dark" data-toggle="modal" data-target="#favoriteBrandsChoice">
                <h2 class="mt-5 arrow-header">Mes marques préférées<br>
                    <img src="{{ asset('build/images/fleche/fbnoir.png') }}" class="w-25">
                </h2>
            </a>
            <div class="modal fade" id="favoriteBrandsChoice" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="form-group col-lg-8 col-md-6 col-sm-12 col-12 align-self-center">
                            {{ form_help(form.favoriteBrands) }}
                            {{ form_widget(form.favoriteBrands) }}
                            {{ form_errors(form.favoriteBrands) }}
                        </div>
                        <div class="form-group col-lg-8 col-md-6 col-sm-12 col-12 align-self-center">
                            {{ form_help(form.brandSuggestion) }}
                            {{ form_widget(form.brandSuggestion) }}
                            {{ form_errors(form.brandSuggestion) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container d-flex flex-column mt-3">
            <a class="journey-link-dark mb-5" data-toggle="modal" data-target="#favoriteDestinationsChoice">
                <h2 class="mt-5 arrow-header">Mes destinations préférées<br>
                    <img src="{{ asset('build/images/fleche/fbnoir.png') }}" class="w-25">
                </h2>
            </a>
            <div class="modal fade" id="favoriteDestinationsChoice" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="form-group col-lg-8 col-md-6 col-sm-12 col-12 align-self-center">
                            {{ form_help(form.favoriteDestination) }}
                            {{ form_widget(form.favoriteDestination) }}
                            {{ form_errors(form.favoriteDestination) }}
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn-login btn btn-lg col-6 col-lg-4 mb-4 align-self-center mx-3">Enregistrer mes modifications</button>
            {{ form_end(form) }}
        </div>
        <div class="container margin">
            <h2 class="mb-4"> Mes aventures - {{ challenges|length }}</h2>
            <div class="form-kyosc d-flex align-items-center justify-content-center mb-5">
                <a href="{{ path('challenge_new') }}" class="btn-login btn btn-lg">Créer une aventure</a>
            </div>
        </div>
        {% if challenges|length < 3 %}
            <div class="d-flex flex-column flex-md-row justify-content-center align-items-center">
            {% for challenge in challenges|slice(0, 3) %}
                <div class="index-card-max-width card col-12 col-sm-6 col-md-4 col-xl-3 p-3 position-relative m-4">
                    <a class=" text-decoration-none text-dark h-100"  href="{{ path("challenge_show", {id: challenge.id}) }}">
                        <p class="title-date-card text-center bg-dark text-white m-0">{{ challenge.dateStart|format_datetime(pattern="dd MMMM Y",locale='fr')  }}</p>
                        <div class="position-relative" >
                            {% if challenge.challengePhoto is not null %}
                                <img src="{{ vich_uploader_asset(challenge, 'challengePhotoFile') | imagine_filter('challenge_thumb')  }}"
                                     alt="photo du challenge" class="w-100 challenge-photo-container">
                            {% else %}
                                <img src="{{ asset('uploads/challenge/challenge-default.jpeg') }}"
                                     alt="photo par défaut du challenge" class="w-100 challenge-photo-container">
                            {% endif %}
                            <div class="white-circle-img-goutte"></div>
                            <img class="img-goutte-index" src="{{ asset('/uploads/goutte/'~challenge.sports['0'].goutte) }}" alt="logo goutte">
                        </div>
                        <div class="card-body p-2">
                            <h3 class="card-title h6 text-center text-uppercase">{{ challenge.title | capitalize }}</h3>
                        </div>
                    </a>
                    <div class="d-flex justify-content-around">
                        <a class="btn btn-register" href="{{ path('challenge_edit', {id: challenge.id})}}">Modifier</a>
                        {{ include('challenge/_delete_form.html.twig') }}
                    </div>
                </div>
            {% else %}
                <p class="text-center">Vous n'avez pas encore créé d'aventure</p>
            {% endfor %}
            </div>
        {% else %}
        <div class="d-flex align-items-center justify-content-center">
            <!--Carousel Wrapper-->
            <div id="multi-item-example" class="carousel slide carousel-multi-item w-75" data-ride="carousel">
                <!--Controls-->
                <div class="controls-top">
                    <a class="btn-floating" href="#multi-item-example" data-slide="prev">
                        <img src="{{ asset('build/images/fleche/fgblanc.png') }}" class="left-arrow-carousel"/>
                    </a>
                    <a class="btn-floating" href="#multi-item-example" data-slide="next">
                        <img src="{{ asset('build/images/fleche/fdnoir.png') }}" class="right-arrow-carousel"/>
                    </a>
                </div>
                <!--/.Controls-->
                <!--Slides-->
                <div class="carousel-inner" role="listbox">
                    {% for iteration in challenges %}
                        {% if loop.first %}
                        <!--First slide-->
                        <div class="carousel-item active pl-md-5">
                            {% for challenge in challenges|slice(0, 3) %}
                                <div class="card col-12 col-sm-6 col-md-4 col-xl-3 p-3 position-relative m-4" style="float:left">
                                    <a class=" text-decoration-none text-dark h-100"  href="{{ path("challenge_show", {id: challenge.id}) }}">
                                        <p class="title-date-card text-center bg-dark text-white m-0">{{ challenge.dateStart|format_datetime(pattern="dd MMMM Y",locale='fr')  }}</p>
                                        <div class="position-relative" >
                                            {% if challenge.challengePhoto is not null %}
                                                <img src="{{ vich_uploader_asset(challenge, 'challengePhotoFile') | imagine_filter('challenge_thumb')  }}"
                                                     alt="photo du challenge" class="w-100 challenge-photo-container">
                                            {% else %}
                                                <img src="{{ asset('uploads/challenge/challenge-default.jpeg') }}"
                                                     alt="photo par défaut du challenge" class="w-100 challenge-photo-container">
                                            {% endif %}
                                            <div class="white-circle-img-goutte"></div>
                                            <img class="img-goutte-index" src="{{ asset('/uploads/goutte/'~challenge.sports['0'].goutte) }}" alt="logo goutte">
                                        </div>
                                        <div class="card-body p-2">
                                            <h3 class="card-title h6 text-center text-uppercase">{{ challenge.title | capitalize }}</h3>
                                        </div>
                                    </a>
                                    <div class="d-flex justify-content-around">
                                        <a class="btn btn-register" href="{{ path('challenge_edit', {id: challenge.id})}}">Modifier</a>
                                        {{ include('challenge/_delete_form.html.twig') }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <!--/.First slide-->
                        {% elseif loop.index is divisible by(3) %}
                        <!--#{{ loop.index }} slide-->
                        <div class="carousel-item pl-md-5">
                            {% for challenge in challenges|slice(loop.index, 3) %}
                                <div class="card col-12 col-sm-6 col-md-4 col-xl-3 p-3 position-relative m-4" style="float:left">
                                    <a class=" text-decoration-none text-dark h-100"  href="{{ path("challenge_show", {id: challenge.id}) }}">
                                        <p class="title-date-card text-center bg-dark text-white m-0">{{ challenge.dateStart|format_datetime(pattern="dd MMMM Y",locale='fr')  }}</p>
                                        <div class="position-relative" >
                                            {% if challenge.challengePhoto is not null %}
                                                <img src="{{ vich_uploader_asset(challenge, 'challengePhotoFile') | imagine_filter('challenge_thumb')  }}"
                                                     alt="photo du challenge" class="w-100 challenge-photo-container">
                                            {% else %}
                                                <img src="{{ asset('uploads/challenge/challenge-default.jpeg') }}"
                                                     alt="photo par défaut du challenge" class="w-100 challenge-photo-container">
                                            {% endif %}
                                            <div class="white-circle-img-goutte"></div>
                                            <img class="img-goutte-index" src="{{ asset('/uploads/goutte/'~challenge.sports['0'].goutte) }}" alt="logo goutte">
                                        </div>
                                        <div class="card-body p-2">
                                            <h3 class="card-title h6 text-center text-uppercase">{{ challenge.title | capitalize }}</h3>
                                        </div>
                                    </a>
                                    <div class="d-flex justify-content-around">
                                        <a class="btn btn-register" href="{{ path('challenge_edit', {id: challenge.id})}}">Modifier</a>
                                        {{ include('challenge/_delete_form.html.twig') }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <!--/.#{{ loop.index }} slide-->
                        {% endif %}
                    {% endfor %}
                </div>
                <!--/.Slides-->
            </div>
            <!--/.Carousel Wrapper-->
        </div>
        {% endif %}
        <div class="container margin mt-4">
            <h2 class="mb-4"> Mes clans créés - {{ user.createdClans|length }}</h2>
            <div class="form-kyosc d-flex align-items-center justify-content-center mb-5">
                <a href="{{ path('clan_new') }}" class="btn-login btn btn-lg">Créer un clan</a>
            </div>
        </div>
        <div class="d-flex flex-column align-items-center scroll-comment">
            {% for clan in user.createdClans %}
                <div class="d-flex flex-column flex-md-row align-items-center justify-content-between w-75 p-2">
                    {% if clan.banner is not null %}
                        <img class="avatar-testimony" src={{ vich_uploader_asset(clan, 'bannerFile') | imagine_filter('square_logo_thumb') }}>
                    {% else %}
                        <img src="{{ asset('uploads/profils/default-profil-picture.png') }}" alt="default profil picture " class="avatar-testimony">
                    {% endif %}
                    <div class="d-flex flex-column align-items-center">
                        <h2 class="card-title text-center text-uppercase">{{ clan.name }}</h2>
                        <p>Créé le {{ clan.createdAt |format_datetime(pattern="dd MMMM Y",locale='fr') }}</p>
                    </div>
                    <div class="d-flex flex-md-row justify-content-between">
                        <div class="d-flex flex-column flex-md-row">
                            <a class="btn btn-profil m-1" href="{{ path("clan_show", {id: clan.id}) }}">Voir la page publique</a>
                            <a class="btn btn-login m-1" href="{{ path("clan_my-clan", {id: clan.id}) }}">Voir la page privée</a>
                        </div>
                        <div class="d-flex flex-column flex-md-row">
                            <a class="btn btn-register m-1" href="{{ path('clan_edit', {id: clan.id})}}">Modifier</a>
                            {{ include('clan/_delete_form.html.twig') }}
                        </div>
                    </div>
                </div>
            {% else %}
                <p>Vous n'avez pas encore créé de clan</p>
            {% endfor %}
        </div>
        <section class="mt-5 pb-5">
            <div class="container margin">
                <h2 class="mb-4"> Les clans dont je suis membre - {{ user.clans|length }}</h2>
            </div>
            <div class="d-flex flex-column align-items-center scroll-comment">
                {% for clan in user.clans %}
                    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between w-75 p-2">
                        {% if clan.banner is not null %}
                            <img class="avatar-testimony" src={{ vich_uploader_asset(clan, 'bannerFile') | imagine_filter('square_logo_thumb') }}>
                        {% else %}
                            <img src="{{ asset('uploads/profils/default-profil-picture.png') }}" alt="default profil picture " class="avatar-testimony">
                        {% endif %}
                        <div class="d-flex flex-column align-items-center">
                            <h2 class="card-title text-center text-uppercase">{{ clan.name }}</h2>
                            <p>Créé le {{ clan.createdAt |format_datetime(pattern="dd MMMM Y",locale='fr') }}</p>
                        </div>
                        <div class="d-flex flex-md-row justify-content-between">
                            <div class="d-flex flex-column flex-md-row">
                                <a class="btn btn-profil m-1" href="{{ path("clan_show", {id: clan.id}) }}">Voir la page publique</a>
                                <a class="btn btn-login m-1" href="{{ path("clan_my-clan", {id: clan.id}) }}">Voir la page privée</a>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <p>Vous ne faites parti d'aucun clan</p>
                {% endfor %}
            </div>
        </section>
        <div class="mt-5 pb-5 d-flex flex-column align-items-center">
            {% include('user/_delete_form.html.twig') %}
        </div>
    </div>
{% endblock body %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(function(){
            $('.select-favoriteBrands').select2();
        });
    </script>
    <script>
        $(document).ready(function () {
            bsCustomFileInput.init()
        })
    </script>
    {{ encore_entry_script_tags('checkbox') }}
    <script>
        const output = document.getElementById('output');
        function loadFile() {
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function () {
                URL.revokeObjectURL(output.src);
            };
        }
    </script>
{% endblock %}
